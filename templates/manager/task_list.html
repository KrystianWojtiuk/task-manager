{% extends "base.html" %}

{% block title %}
  Tasks
{% endblock %}

{% block content %}
  <div class="container">
    <h1 class="text-center mb-1">Tasks <a href="{% url 'manager:task-create' %}" class="btn btn-success">
      Add
    </a></h1>

    <!-- Project filter dropdown -->
    <form method="get" class="mb-2" style="width: 50%">
      <label for="projectSelect" class="form-label">Filter by project:</label>
      <select name="project" id="projectSelect" class="form-select" onchange="this.form.submit()">
        <option value="">All Projects</option>
        {% for project in projects %}
          <option value="{{ project.id }}"
                  {% if request.GET.project == project.id|stringformat:"s" %}selected{% endif %}>
            {{ project.name }}
          </option>
        {% endfor %}
      </select>
    </form>

    <!-- Tasks table -->
    <table class="table table-striped table-hover table-bordered align-middle" id="myTable">
      <thead class="table-dark">
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Type</th>
        <th scope="col">Priority</th>
        <th scope="col">Deadline</th>
        <th scope="col">Completed</th>
        <th scope="col">Project</th>
      </tr>
      </thead>
      <tbody>
      {% for task in tasks %}
        <tr>
          <td>
            <a href={% url 'manager:task-detail' task.id %}>{{ task.name }}</a>
          </td>
          <td>{{ task.task_type }}</td>
          <td>{{ task.priority }}</td>
          <td>{{ task.deadline }}</td>
          <td>{{ task.is_complete|yesno:"✅,❌" }}</td>
          <td>
            <a href={% url 'manager:project-detail' task.project.id %}>{{ task.project.name }}</a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6" class="text-center">No tasks found</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
